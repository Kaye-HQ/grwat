---
params:
    name: "Хопёр"
    file_tot: "Total.txt"
    file_sep: "AllGrWat.txt"
    locale: "EN"
    year: 1978
    fixedyear: false
date: "`r Sys.Date()`"
title: "`r params$name`"
author: "`r switch(params$locale, 'EN' = 'Report produced by R GrWat package', 'RU' = 'Отчет подготовлен с помощью пакета R GrWat')`"
output: 
  pdf_document:
    toc: true
    dev: cairo_pdf
documentclass: report
classoption: landscape
geometry: "left=1cm,right=1cm,top=1cm,bottom=2cm"
header-includes:
   #- \usepackage[T2A]{fontenc}
   - \usepackage[utf8]{inputenc}
   #- \usepackage[russian]{babel}
   - \usepackage[fontsize=16pt]{scrextend}
   - \usepackage[table]{xcolor}
   - \usepackage{longtable}
   - \usepackage{booktabs}
#mainfont: Open Sans
---

<!-- Settings -->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(include=FALSE)
```

```{r, include=TRUE}
asis_output("# Input data")
```
\pagebreak
```{r, include=TRUE}
asis_output("Reanalysis data inside the basin")
```

```{r, include=TRUE, warning=FALSE, message=FALSE, out.height='7in'}
pngfile = stringr::str_interp("${opts_knit$get('root.dir')}/${list.files('.', '*.png')[1]}")
knitr::include_graphics(pngfile)
```

```{r, include=TRUE}
asis_output("# Hydrograph separation")
```
\pagebreak

```{r, include=TRUE, results='asis', warning=FALSE, message=FALSE, fig.height=8, fig.width=11}
params$file_sep %>% 
  grwat::read_separation() %>% 
  grwat::plot_separation(layout = matrix(c(1,2,3,4), nrow=2, byrow=TRUE),
                         locale = params$locale,
                         pagebreak = TRUE)
```


<!-- Main plots -->
```{r, include=TRUE}
asis_output("# Interannual changes")
```
\pagebreak

```{r, include=TRUE, results='asis', warning=FALSE, message=FALSE, fig.height=8, fig.width=11}
total = grwat::read_parameters(params$file_tot)
tests = grwat::run_tests(total)
grwat::plot_parameters(total, tests, locale = params$locale)
```

```{r, include=TRUE}
asis_output("# Long-term changes")
```
\pagebreak

```{r, fig.height=8, fig.width=11, warning=FALSE, include = TRUE, results='asis', echo=FALSE, message=FALSE}
grwat::plot_minmonth(total, locale = params$locale)
```
```{r, fig.height=3.8, fig.width=11, warning=FALSE, include = TRUE, results='asis', echo=FALSE, message=FALSE}
grwat::plot_periods(total, locale = params$locale)
```

<!-- Stats -->
```{r, include=TRUE}
asis_output("# Statistical tests")
```
\pagebreak

<!-- Knit table to PDF -->
```{r, include = TRUE, results='asis', warning=FALSE, message=FALSE}
grwat::kable_tests(tests)
```

<!-- Write stats to table -->
```{r}
tests$stable %>% write_xlsx(paste('pvalues_', params$name, '.xlsx', sep=''))
```